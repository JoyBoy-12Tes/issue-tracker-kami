<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Issue Tracker Helpdesk</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f9f9f9;
    }
    input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .article {
      background: white;
      border-radius: 6px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      overflow: hidden;
    }
    .article h3 {
      margin: 0;
      padding: 12px;
      cursor: pointer;
      background: #f1f1f1;
    }
    .content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease, padding 0.3s ease;
      padding: 0 12px;
    }
    .content.open {
      padding: 12px;
      max-height: 1000px;
    }
    .content img {
      max-width: 100%;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    mark {
      background: yellow;
    }
  </style>
</head>

<body>

<h2>ðŸ“š Issue Tracker Helpdesk</h2>

<input id="search" placeholder="Cari judul artikel..." />

<div id="list"><p>Memuat data...</p></div>

<script>
  const API_KEY = "AIzaSyCP1doJdwsMteYt1pylBjOWnRMAsZ5o4IU";
  const SHEET_ID = "1DGR6pjJvvasX9OO0W5TuEhyatDAe7vjtnmfeubBZ65E";
  const SHEET_NAME = "Sheet1";

  const apiUrl =
    `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;

  let dataArticles = [];
  let activeIndex = null;

  function highlight(text, keyword) {
    if (!keyword) return text;
    const regex = new RegExp(`(${keyword})`, "gi");
    return text.replace(regex, "<mark>$1</mark>");
  }

  function toggle(index) {
    if (activeIndex !== null && activeIndex !== index) {
      document.getElementById("content-" + activeIndex)?.classList.remove("open");
    }
    const el = document.getElementById("content-" + index);
    el.classList.toggle("open");
    activeIndex = el.classList.contains("open") ? index : null;
  }

  function renderArticles(keyword) {
    const list = document.getElementById("list");
    list.innerHTML = "";

    const filtered = dataArticles.filter(item =>
      item.judul.toLowerCase().includes(keyword.toLowerCase())
    );

    if (!filtered.length) {
      list.innerHTML = "<p>Tidak ada artikel ditemukan.</p>";
      return;
    }

    filtered.forEach((item, index) => {
      list.innerHTML += `
        <div class="article">
          <h3 onclick="toggle(${index})">
            ${highlight(item.judul, keyword)}
          </h3>
          <div class="content" id="content-${index}">
            ${item.gambar ? `<img src="${item.gambar}">` : ""}
            <div>${item.isi}</div>
          </div>
        </div>
      `;
    });
  }

  fetch(apiUrl)
    .then(res => res.json())
    .then(data => {
      const rows = data.values;
      rows.shift();

      dataArticles = rows.map(r => ({
        judul: r[0] || "",
        isi: r[1] || "",
        gambar: r[2] || ""
      }));

      document.getElementById("list").innerHTML =
        "<p>Ketik kata kunci untuk mencari artikel.</p>";
    })
    .catch(err => {
      console.error(err);
      document.getElementById("list").innerHTML =
        "<p>Gagal memuat data</p>";
    });

  document.getElementById("search").addEventListener("keyup", e => {
    activeIndex = null;
    renderArticles(e.target.value);
  });
</script>

</body>
</html>

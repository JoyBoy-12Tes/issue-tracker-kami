<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Issue Tracker Helpdesk</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(90deg, #e3f2fd, #ffffff, #e3f2fd);
  margin: 0;
}

.container {
  max-width: 900px;
  margin: 40px auto;
  background: #fff;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 25px;
  border-radius: 12px;
  background: linear-gradient(135deg, #42a5f5, #64b5f6);
  color: #fff;
}

.header .icon {
  font-size: 60px;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: 1px solid #d0e2f2;
  border-radius: 10px;
  margin-bottom: 22px;
}

/* Issue list */
.issue-item {
  border: 1px solid #e0e0e0;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 12px;
  cursor: pointer;
  transition: 0.2s;
}

.issue-item:hover {
  background: #f1f8ff;
  border-color: #90caf9;
}

.issue-title {
  font-weight: bold;
  font-size: 16px;
  color: #1976d2;
}

/* Detail (hidden) */
.issue-detail {
  display: none;
  margin-top: 12px;
  border-top: 1px dashed #cfd8dc;
  padding-top: 12px;
}

.section h4 {
  margin: 8px 0 4px;
  color: #1565c0;
}

img {
  max-width: 100%;
  margin-top: 10px;
  border-radius: 10px;
}

/* Footer */
.footer {
  text-align: center;
  margin-top: 40px;
  color: #777;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <div class="icon">ðŸ“˜ðŸš€</div>
    <h1>Issue Tracker Helpdesk</h1>
    <p>Pusat solusi & panduan penanganan issue</p>
  </div>

  <input id="search" placeholder="Cari issue..." />

  <div id="list"></div>

  <div class="footer">
    Â© <span id="year"></span> Helpdesk
  </div>
</div>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

/* SHEET URL (ANTI CACHE) */
const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQCLXvz4_F7EfUppPoKWSKQawlesCjiYHhceQCIEDoV8ntbDjFrvKUorP416AGydpWYmxWlOLA3b1JL/pub?gid=0&single=true&output=csv&t="
  + Date.now();

let issues = [];

/* FETCH DATA */
fetch(SHEET_URL)
  .then(r => r.text())
  .then(csv => {
    const rows = csv.trim().split("\n").slice(1);
    issues = rows.map(r => {
      const c = r.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g) || [];
      return {
        issue: c[0]?.replace(/"/g,"").trim(),
        solusi: c[1]?.replace(/"/g,"").trim(),
        langkah: c[2]?.replace(/"/g,"").trim(),
        image_id: c[3]?.replace(/"/g,"").trim()
      };
    });
    renderList(issues);
  });

/* RENDER ISSUE LIST (ISSUE SAJA) */
function renderList(data) {
  const list = document.getElementById("list");
  list.innerHTML = "";

  if (!data.length) {
    list.innerHTML = "<div style='color:#999'>Issue tidak ditemukan</div>";
    return;
  }

  data.forEach(item => {
    const div = document.createElement("div");
    div.className = "issue-item";

    const imageHTML =
      item.image_id && item.image_id.toLowerCase() !== "kosong"
        ? `<img src="https://drive.google.com/uc?id=${item.image_id}">`
        : "";

    div.innerHTML = `
      <div class="issue-title">${item.issue}</div>
      <div class="issue-detail">
        <div class="section">
          <h4>Solusi</h4>
          <p>${item.solusi}</p>
        </div>
        <div class="section">
          <h4>Langkah-langkah</h4>
          <p>${item.langkah}</p>
        </div>
        ${imageHTML}
      </div>
    `;

    div.onclick = () => {
      const d = div.querySelector(".issue-detail");
      d.style.display = d.style.display === "block" ? "none" : "block";
    };

    list.appendChild(div);
  });
}

/* SEARCH â†’ ISSUE ONLY */
document.getElementById("search").addEventListener("input", e => {
  const key = e.target.value.toLowerCase();
  renderList(
    issues.filter(i => i.issue.toLowerCase().includes(key))
  );
});
</script>

</body>
</html>
